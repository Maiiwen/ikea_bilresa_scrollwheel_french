blueprint:
  name: "IKEA Bilresa – 3 boutons"
  description: "3 boutons indépendants (clic 1×/2×/3× + maintien pour dimmer par bouton) + support des volets/rideaux (cover)"
  domain: automation

  input:
    # ════════════════════════════════════════════════════════════
    # BOUTON 1
    # ════════════════════════════════════════════════════════════
    button1_event_entity:
      name: "Bouton 1 – Entité d’événement"
      description: "Entité d’événement du bouton 1"
      selector:
        entity:
          domain: event

    button1_single_press_light:
      name: "Bouton 1 – Clic 1× – Lampe"
      selector:
        entity:
          domain: light
      default: ""

    button1_single_press_action:
      name: "Bouton 1 – Clic 1× – Action"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "toggle"

    button1_double_press_light:
      name: "Bouton 1 – Clic 2× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button1_double_press_type:
      name: "Bouton 1 – Clic 2× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
      default: "light"

    button1_double_press_light_action:
      name: "Bouton 1 – Clic 2× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_50"

    button1_double_press_scene:
      name: "Bouton 1 – Clic 2× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button1_triple_press_light:
      name: "Bouton 1 – Clic 3× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button1_triple_press_type:
      name: "Bouton 1 – Clic 3× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
      default: "light"

    button1_triple_press_light_action:
      name: "Bouton 1 – Clic 3× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_100"

    button1_triple_press_scene:
      name: "Bouton 1 – Clic 3× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button1_hold_light:
      name: "Bouton 1 – Maintenir/Relâcher – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button1_hold_direction:
      name: "Bouton 1 – Sens de variation (maintien)"
      selector:
        select:
          options:
            - label: "Augmenter (plus lumineux)"
              value: "brighter"
            - label: "Diminuer (plus sombre)"
              value: "darker"
      default: "brighter"

    button1_hold_brightness_step:
      name: "Bouton 1 – Variation par pas (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BOUTON 2
    # ════════════════════════════════════════════════════════════
    button2_event_entity:
      name: "Bouton 2 – Entité d’événement (optionnel)"
      selector:
        entity:
          domain: event
      default: ""

    button2_single_press_light:
      name: "Bouton 2 – Clic 1× – Lampe"
      selector:
        entity:
          domain: light
      default: ""

    button2_single_press_action:
      name: "Bouton 2 – Clic 1× – Action"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "toggle"

    button2_double_press_light:
      name: "Bouton 2 – Clic 2× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button2_double_press_type:
      name: "Bouton 2 – Clic 2× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
      default: "light"

    button2_double_press_light_action:
      name: "Bouton 2 – Clic 2× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_50"

    button2_double_press_scene:
      name: "Bouton 2 – Clic 2× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button2_triple_press_light:
      name: "Bouton 2 – Clic 3× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button2_triple_press_type:
      name: "Bouton 2 – Clic 3× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
      default: "light"

    button2_triple_press_light_action:
      name: "Bouton 2 – Clic 3× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_100"

    button2_triple_press_scene:
      name: "Bouton 2 – Clic 3× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button2_hold_light:
      name: "Bouton 2 – Maintenir/Relâcher – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button2_hold_direction:
      name: "Bouton 2 – Sens de variation (maintien)"
      selector:
        select:
          options:
            - label: "Augmenter (plus lumineux)"
              value: "brighter"
            - label: "Diminuer (plus sombre)"
              value: "darker"
      default: "brighter"

    button2_hold_brightness_step:
      name: "Bouton 2 – Variation par pas (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BOUTON 3 (avec support Cover)
    # ════════════════════════════════════════════════════════════
    button3_event_entity:
      name: "Bouton 3 – Entité d’événement (optionnel)"
      selector:
        entity:
          domain: event
      default: ""

    button3_single_press_light:
      name: "Bouton 3 – Clic 1× – Lampe"
      selector:
        entity:
          domain: light
      default: ""

    button3_single_press_type:
      name: "Bouton 3 – Clic 1× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
            - label: "Volet / Rideau (ouvrir/fermer)"
              value: "cover"
      default: "light"

    button3_single_press_action:
      name: "Bouton 3 – Clic 1× – Action"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "toggle"

    button3_single_press_scene:
      name: "Bouton 3 – Clic 1× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_single_press_cover:
      name: "Bouton 3 – Clic 1× – Cover/Volet (optionnel)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_single_press_cover_action:
      name: "Bouton 3 – Clic 1× – Action Cover"
      selector:
        select:
          options:
            - label: "Basculer"
              value: "toggle"
            - label: "Ouvrir"
              value: "open"
            - label: "Fermer"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_double_press_light:
      name: "Bouton 3 – Clic 2× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button3_double_press_type:
      name: "Bouton 3 – Clic 2× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
            - label: "Volet / Rideau (ouvrir/fermer)"
              value: "cover"
      default: "light"

    button3_double_press_light_action:
      name: "Bouton 3 – Clic 2× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_50"

    button3_double_press_scene:
      name: "Bouton 3 – Clic 2× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_double_press_cover:
      name: "Bouton 3 – Clic 2× – Cover/Volet (optionnel)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_double_press_cover_action:
      name: "Bouton 3 – Clic 2× – Action Cover"
      selector:
        select:
          options:
            - label: "Basculer"
              value: "toggle"
            - label: "Ouvrir"
              value: "open"
            - label: "Fermer"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_triple_press_light:
      name: "Bouton 3 – Clic 3× – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button3_triple_press_type:
      name: "Bouton 3 – Clic 3× – Type d’action"
      selector:
        select:
          options:
            - label: "Lampe (luminosité/bascule)"
              value: "light"
            - label: "Activer une scène"
              value: "scene"
            - label: "Volet / Rideau (ouvrir/fermer)"
              value: "cover"
      default: "light"

    button3_triple_press_light_action:
      name: "Bouton 3 – Clic 3× – Action (lampe)"
      selector:
        select:
          options:
            - label: "Basculer (On/Off)"
              value: "toggle"
            - label: "Allumer"
              value: "turn_on"
            - label: "Éteindre"
              value: "turn_off"
            - label: "Luminosité 25%"
              value: "brightness_25"
            - label: "Luminosité 50%"
              value: "brightness_50"
            - label: "Luminosité 75%"
              value: "brightness_75"
            - label: "Luminosité 100%"
              value: "brightness_100"
      default: "brightness_100"

    button3_triple_press_scene:
      name: "Bouton 3 – Clic 3× – Scène (optionnel)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_triple_press_cover:
      name: "Bouton 3 – Clic 3× – Cover/Volet (optionnel)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_triple_press_cover_action:
      name: "Bouton 3 – Clic 3× – Action Cover"
      selector:
        select:
          options:
            - label: "Basculer"
              value: "toggle"
            - label: "Ouvrir"
              value: "open"
            - label: "Fermer"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_hold_light:
      name: "Bouton 3 – Maintenir/Relâcher – Lampe (optionnel)"
      selector:
        entity:
          domain: light
      default: ""

    button3_hold_direction:
      name: "Bouton 3 – Sens de variation (maintien)"
      selector:
        select:
          options:
            - label: "Augmenter (plus lumineux)"
              value: "brighter"
            - label: "Diminuer (plus sombre)"
              value: "darker"
      default: "brighter"

    button3_hold_brightness_step:
      name: "Bouton 3 – Variation par pas (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

trigger:
  - platform: state
    entity_id:
      - !input button1_event_entity
    id: button1

  - platform: state
    entity_id:
      - !input button2_event_entity
    id: button2

  - platform: state
    entity_id:
      - !input button3_event_entity
    id: button3

condition: []

action:
  - variables:
      button1_event: !input button1_event_entity
      button2_event: !input button2_event_entity
      button3_event: !input button3_event_entity

      button1_single_press_light_value: !input button1_single_press_light
      button1_single_press_action_value: !input button1_single_press_action
      button1_double_press_light_value: !input button1_double_press_light
      button1_double_press_type_value: !input button1_double_press_type
      button1_double_press_light_action_value: !input button1_double_press_light_action
      button1_double_press_scene_value: !input button1_double_press_scene
      button1_triple_press_light_value: !input button1_triple_press_light
      button1_triple_press_type_value: !input button1_triple_press_type
      button1_triple_press_light_action_value: !input button1_triple_press_light_action
      button1_triple_press_scene_value: !input button1_triple_press_scene
      button1_hold_light_value: !input button1_hold_light
      button1_hold_direction_value: !input button1_hold_direction
      button1_hold_brightness_step_value: !input button1_hold_brightness_step

      button2_single_press_light_value: !input button2_single_press_light
      button2_single_press_action_value: !input button2_single_press_action
      button2_double_press_light_value: !input button2_double_press_light
      button2_double_press_type_value: !input button2_double_press_type
      button2_double_press_light_action_value: !input button2_double_press_light_action
      button2_double_press_scene_value: !input button2_double_press_scene
      button2_triple_press_light_value: !input button2_triple_press_light
      button2_triple_press_type_value: !input button2_triple_press_type
      button2_triple_press_light_action_value: !input button2_triple_press_light_action
      button2_triple_press_scene_value: !input button2_triple_press_scene
      button2_hold_light_value: !input button2_hold_light
      button2_hold_direction_value: !input button2_hold_direction
      button2_hold_brightness_step_value: !input button2_hold_brightness_step

      button3_single_press_type_var: !input button3_single_press_type
      button3_single_press_light_value: !input button3_single_press_light
      button3_single_press_action_value: !input button3_single_press_action
      button3_single_press_scene_var: !input button3_single_press_scene
      button3_single_press_cover_var: !input button3_single_press_cover
      button3_single_press_cover_action_var: !input button3_single_press_cover_action

      button3_double_press_type_var: !input button3_double_press_type
      button3_double_press_light_value: !input button3_double_press_light
      button3_double_press_light_action_value: !input button3_double_press_light_action
      button3_double_press_scene_var: !input button3_double_press_scene
      button3_double_press_cover_var: !input button3_double_press_cover
      button3_double_press_cover_action_var: !input button3_double_press_cover_action

      button3_triple_press_type_var: !input button3_triple_press_type
      button3_triple_press_light_value: !input button3_triple_press_light
      button3_triple_press_light_action_value: !input button3_triple_press_light_action
      button3_triple_press_scene_var: !input button3_triple_press_scene
      button3_triple_press_cover_var: !input button3_triple_press_cover
      button3_triple_press_cover_action_var: !input button3_triple_press_cover_action

      button3_hold_light_value: !input button3_hold_light
      button3_hold_direction_value: !input button3_hold_direction
      button3_hold_brightness_step_value: !input button3_hold_brightness_step

      event_type: "{{ state_attr(trigger.entity_id, 'event_type') }}"
      trigger_entity: "{{ trigger.entity_id }}"

  # ════════════════════════════════════════════════════════════
  # BOUTON 1 - CLIC 1×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_1' and button1_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 1 - CLIC 2×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_2' and button1_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_double_press_type_value == 'scene' and button1_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 1 - CLIC 3×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_3' and button1_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_triple_press_type_value == 'scene' and button1_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 1 - MAINTIEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and (event_type == 'initial_press' or event_type == 'repeat') and button1_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BOUTON 2 - CLIC 1×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_1' and button2_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 2 - CLIC 2×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_2' and button2_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_double_press_type_value == 'scene' and button2_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 2 - CLIC 3×
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_3' and button2_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_triple_press_type_value == 'scene' and button2_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 2 - MAINTIEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and (event_type == 'initial_press' or event_type == 'repeat') and button2_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BOUTON 3 - CLIC 1× (CORRIGÉ)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_1' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_single_press_type_var == 'cover' and button3_single_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_single_press_type_var == 'scene' and button3_single_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_single_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 3 - CLIC 2× (CORRIGÉ)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_2' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_double_press_type_var == 'cover' and button3_double_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_double_press_type_var == 'scene' and button3_double_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_double_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 3 - CLIC 3× (CORRIGÉ)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_3' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_triple_press_type_var == 'cover' and button3_triple_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_triple_press_type_var == 'scene' and button3_triple_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_triple_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BOUTON 3 - MAINTIEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and (event_type == 'initial_press' or event_type == 'repeat') and button3_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value * -1 }}"

mode: parallel
max: 10
